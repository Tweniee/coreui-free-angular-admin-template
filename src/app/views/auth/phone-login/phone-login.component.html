<div class="bg-body-tertiary min-vh-100 d-flex flex-row align-items-center">
  <c-container>
    <c-row class="justify-content-center">
      <c-col md="6" lg="5" xl="4">
        <c-card class="auth-card">
          <c-card-body class="p-4 p-md-5">
            <!-- Logo/Brand Section -->
            <div class="text-center mb-4">
              <div class="auth-logo mb-3">
                <svg
                  cIcon
                  name="cilMobile"
                  size="3xl"
                  style="color: var(--cui-primary)"
                ></svg>
              </div>
              <h2 class="mb-2">Welcome Back</h2>
              <p class="text-body-secondary">
                {{
                  step() === "phone"
                    ? "Enter your phone number to continue"
                    : "Enter the verification code"
                }}
              </p>
            </div>

            <!-- Error Alert -->
            @if (error()) {
              <c-alert
                color="danger"
                [dismissible]="true"
                (visibleChange)="!$event && error.set('')"
              >
                <svg cIcon name="cilWarning" class="me-2"></svg>
                {{ error() }}
              </c-alert>
            }

            <!-- Phone Number Step -->
            @if (step() === "phone") {
              <form (ngSubmit)="sendOtp()">
                <div class="mb-4">
                  <label cLabel for="phoneNumber" class="form-label"
                    >Phone Number</label
                  >
                  <div class="input-group input-group-lg">
                    <span class="input-group-text">
                      <svg cIcon name="cilPhone" size="lg"></svg>
                    </span>
                    <input
                      cFormControl
                      id="phoneNumber"
                      type="tel"
                      placeholder="9876543210"
                      [(ngModel)]="phoneNumber"
                      name="phoneNumber"
                      [disabled]="loading()"
                      maxlength="13"
                      class="form-control-lg"
                    />
                  </div>
                  <small class="text-body-secondary"
                    >Enter 10 digit mobile number</small
                  >
                </div>

                <div class="d-grid">
                  <button
                    cButton
                    color="primary"
                    size="lg"
                    type="submit"
                    [disabled]="loading() || !phoneNumber()"
                    class="position-relative"
                  >
                    @if (loading()) {
                      <c-spinner size="sm" class="me-2"></c-spinner>
                    }
                    @if (!loading()) {
                      <svg cIcon name="cilArrowRight" class="me-2"></svg>
                    }
                    {{ loading() ? "Sending..." : "Send OTP" }}
                  </button>
                </div>
              </form>

              <div class="text-center mt-4">
                <small class="text-body-secondary">
                  By continuing, you agree to our Terms & Privacy Policy
                </small>
              </div>
            }

            <!-- OTP Verification Step -->
            @if (step() === "otp") {
              <div>
                <!-- Phone Number Display -->
                <div class="text-center mb-4">
                  <div class="phone-display">
                    <svg
                      cIcon
                      name="cilCheckCircle"
                      class="text-success me-2"
                    ></svg>
                    <strong>{{ formatPhoneNumber(phoneNumber()) }}</strong>
                  </div>
                  <button
                    cButton
                    color="link"
                    size="sm"
                    (click)="backToPhone()"
                    class="text-decoration-none"
                  >
                    <svg cIcon name="cilPencil" size="sm" class="me-1"></svg>
                    Change number
                  </button>
                </div>

                <!-- OTP Input -->
                <div class="mb-4">
                  <label class="form-label text-center d-block mb-3"
                    >Enter 6-digit code</label
                  >
                  <div class="otp-container">
                    @for (digit of otp(); track $index) {
                      <input
                        type="text"
                        [id]="'otp-' + $index"
                        class="otp-input"
                        maxlength="1"
                        [value]="digit"
                        (input)="onOtpInput($index, $event)"
                        (keydown)="onOtpKeyDown($index, $event)"
                        (paste)="$index === 0 ? onOtpPaste($event) : null"
                        [disabled]="loading()"
                        inputmode="numeric"
                        pattern="[0-9]"
                      />
                    }
                  </div>
                </div>

                <!-- Resend OTP -->
                <div class="text-center mb-4">
                  @if (countdown() > 0) {
                    <small class="text-body-secondary">
                      Resend OTP in <strong>{{ countdown() }}s</strong>
                    </small>
                  } @else {
                    <button
                      cButton
                      color="link"
                      (click)="resendOtp()"
                      [disabled]="loading()"
                      class="text-decoration-none"
                    >
                      <svg cIcon name="cilReload" class="me-1"></svg>
                      Resend OTP
                    </button>
                  }
                </div>

                <!-- Verify Button -->
                <div class="d-grid">
                  <button
                    cButton
                    color="primary"
                    size="lg"
                    (click)="verifyOtp()"
                    [disabled]="loading() || otp().some(d => !d)"
                  >
                    @if (loading()) {
                      <c-spinner size="sm" class="me-2"></c-spinner>
                      Verifying...
                    } @else {
                      <svg cIcon name="cilCheckCircle" class="me-2"></svg>
                      Verify & Continue
                    }
                  </button>
                </div>
              </div>
            }
          </c-card-body>
        </c-card>

        <!-- Footer Info -->
        <div class="text-center mt-4">
          <small class="text-body-secondary">
            <svg cIcon name="cilShieldAlt" size="sm" class="me-1"></svg>
            Your information is secure and encrypted
          </small>
        </div>
      </c-col>
    </c-row>
  </c-container>
</div>
