<div
  class="bg-light dark:bg-transparent min-vh-100 d-flex flex-row align-items-center"
>
  <c-container breakpoint="md">
    <c-row class="justify-content-center">
      <c-col lg="8">
        <c-card-group>
          <c-card class="p-4">
            <c-card-body>
              <!-- Error Alert -->
              @if (error()) {
                <c-alert
                  color="danger"
                  [dismissible]="true"
                  (visibleChange)="!$event && error.set('')"
                >
                  <svg cIcon name="cilWarning" class="me-2"></svg>
                  {{ error() }}
                </c-alert>
              }

              <!-- Phone Number Step -->
              @if (step() === "phone") {
                <form cForm (ngSubmit)="sendOtp()">
                  <h1>Welcome</h1>
                  <p class="text-body-secondary">
                    Sign in with your phone number
                  </p>

                  <c-input-group class="mb-3">
                    <span cInputGroupText>
                      <svg cIcon name="cilPhone"></svg>
                    </span>
                    <input
                      cFormControl
                      type="tel"
                      placeholder="Enter 10 digit mobile number"
                      [(ngModel)]="phoneNumber"
                      name="phoneNumber"
                      [disabled]="loading()"
                      maxlength="13"
                      autoComplete="tel"
                    />
                  </c-input-group>

                  <c-row>
                    <c-col xs="12">
                      <button
                        cButton
                        class="px-4 w-100"
                        color="primary"
                        type="submit"
                        [disabled]="loading() || !phoneNumber()"
                      >
                        @if (loading()) {
                          <c-spinner size="sm" class="me-2"></c-spinner>
                          Sending...
                        } @else {
                          Send OTP
                        }
                      </button>
                    </c-col>
                  </c-row>

                  <div class="mt-3">
                    <small class="text-body-secondary">
                      <svg
                        cIcon
                        name="cilShieldAlt"
                        size="sm"
                        class="me-1"
                      ></svg>
                      Your information is secure and encrypted
                    </small>
                  </div>
                </form>
              }

              <!-- OTP Verification Step -->
              @if (step() === "otp") {
                <div>
                  <h1>Verify OTP</h1>
                  <p class="text-body-secondary">
                    Enter the 6-digit code sent to<br />
                    <strong>{{ formatPhoneNumber(phoneNumber()) }}</strong>
                    <button
                      cButton
                      color="link"
                      size="sm"
                      (click)="backToPhone()"
                      class="text-decoration-none p-0 ms-2"
                    >
                      <svg cIcon name="cilPencil" size="sm"></svg>
                      Change
                    </button>
                  </p>

                  <!-- OTP Input -->
                  <div class="mb-4">
                    <div class="otp-container">
                      @for (digit of otp(); track $index) {
                        <input
                          type="text"
                          [id]="'otp-' + $index"
                          class="otp-input"
                          maxlength="1"
                          [value]="digit"
                          (input)="onOtpInput($index, $event)"
                          (keydown)="onOtpKeyDown($index, $event)"
                          (paste)="$index === 0 ? onOtpPaste($event) : null"
                          [disabled]="loading()"
                          inputmode="numeric"
                          pattern="[0-9]"
                        />
                      }
                    </div>
                  </div>

                  <!-- Resend OTP -->
                  <div class="text-center mb-3">
                    @if (countdown() > 0) {
                      <small class="text-body-secondary">
                        Resend OTP in <strong>{{ countdown() }}s</strong>
                      </small>
                    } @else {
                      <button
                        cButton
                        color="link"
                        (click)="resendOtp()"
                        [disabled]="loading()"
                        class="text-decoration-none p-0"
                      >
                        <svg cIcon name="cilReload" class="me-1"></svg>
                        Resend OTP
                      </button>
                    }
                  </div>

                  <!-- Verify Button -->
                  <c-row>
                    <c-col xs="12">
                      <button
                        cButton
                        class="px-4 w-100"
                        color="primary"
                        (click)="verifyOtp()"
                        [disabled]="loading() || !isOtpComplete()"
                      >
                        @if (loading()) {
                          <c-spinner size="sm" class="me-2"></c-spinner>
                          Verifying...
                        } @else {
                          Verify & Continue
                        }
                      </button>
                    </c-col>
                  </c-row>
                </div>
              }
            </c-card-body>
          </c-card>

          <!-- Branding Card -->
          <c-card [style.minWidth.%]="44" class="text-white bg-primary py-5">
            <c-card-body
              class="text-center d-flex align-items-center justify-content-center"
            >
              <div>
                <div class="mb-4">
                  <svg cIcon name="cilMobile" size="4xl"></svg>
                </div>
                <h2>Phone Authentication</h2>
                <p class="mt-3">
                  Quick and secure login using your mobile number. Get instant
                  access with OTP verification.
                </p>
                <div class="mt-4">
                  <small>
                    <svg cIcon name="cilCheckCircle" class="me-2"></svg>
                    Fast & Secure
                  </small>
                  <br />
                  <small>
                    <svg cIcon name="cilCheckCircle" class="me-2"></svg>
                    No Password Required
                  </small>
                  <br />
                  <small>
                    <svg cIcon name="cilCheckCircle" class="me-2"></svg>
                    One-Time Verification
                  </small>
                </div>
              </div>
            </c-card-body>
          </c-card>
        </c-card-group>
      </c-col>
    </c-row>
  </c-container>
</div>
